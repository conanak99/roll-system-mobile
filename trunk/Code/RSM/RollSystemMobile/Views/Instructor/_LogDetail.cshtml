@model RollSystemMobile.Models.ViewModels.LogDetailViewModel
@{
    Layout = null;
}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
        ×</button>
    <h3 id="myModalLabel">Roll Call at @Model.AutoLog.LogDate.ToString("dd-MM-yyyy")</h3>
</div>
<div class="modal-body" id='modal-body'>
    <legend>Roll Call Info</legend>
    <fieldset style="margin: -20px 0 -20px -20px">
        <dl class="dl-horizontal">
            <dt>Roll Call</dt>
            <dd>@Model.RollCall.RollCallID</dd>
            <dt>Date</dt>
            <dd>@Model.AutoLog.LogDate.ToString("dd-MM-yyyy")</dd>
            <dt>Subject</dt>
            <dd>@Model.RollCall.Subject.ShortName</dd>
            <dt>Class</dt>
            <dd>@Model.RollCall.Class.ClassID</dd>
        </dl>
    </fieldset>
    <legend>Log Image</legend>
    <fieldset class="text-center">
        @foreach (var Image in @Model.AutoLog.LogImages.Take(2))
        {
            <img src="@Url.Content("~/Content/Log/" + Image.ImageLink)" class="image-log"/>
        }
    </fieldset>
    <legend>Attendance</legend>
    <fieldset>
        <div class="text-center">
            @{
                RollSystemMobile.Models.AttendanceLog CurrentAttendanceLog = null;
                if (Model.ManualLog != null)
                {
                    CurrentAttendanceLog = Model.ManualLog;
                }
                else
                {
                    CurrentAttendanceLog = Model.AutoLog;
                }
            }
            @using (Html.BeginForm("CheckAttendanceManual", "Instructor", FormMethod.Post))
            {
                <input type="hidden" name="RollCallID" value="@Model.RollCall.RollCallID" />
                <input type="hidden" name="Date" value="@Model.AutoLog.LogDate" />
                <input type="hidden" name="ReturnUrl" value="@Url.Action("RollCallDetail","Instructor",new{ id = Model.RollCall.RollCallID })" />
                <!-- Tao form check attendace dua tren log hien tai -->
                <table class="table table-striped table-condensed">
                    <thead>
                        <tr>
                            <th class="text-right">
                                No
                            </th>
                            <th>
                                Student Name
                            </th>
                            <th>
                                Present
                            </th>
                            <th>
                                Absent
                            </th>
                            <th>
                                Note
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @{int AttendIndex = 1;
                          int CheckIndex = 0;
                        }
                        @foreach (var Student in Model.RollCall.Students)
                        {
                            <tr>
                                <input type="hidden" name="AttendanceChecks.Index" value="@CheckIndex" />
                                <input type="hidden" name="AttendanceChecks[@CheckIndex].StudentID" value="@Student.StudentID" />
                                <td class="text-right">
                                    @AttendIndex
                                </td>
                                <td>
                                    @Student.FullName
                                </td>
                                @{  //Hien thi danh sach de danh lai attendance
                            RollSystemMobile.Models.StudentAttendance Attendance = null;
                            if (CurrentAttendanceLog != null)
                            {
                                Attendance = CurrentAttendanceLog.StudentAttendances.
                                             FirstOrDefault(attend => attend.StudentID == Student.StudentID);
                            }
                                }
                                @if (Attendance == null)
                                {
                                    <td class="text-center">
                                        <input type="radio" name="AttendanceChecks[@CheckIndex].IsPresent" value="true"/>
                                    </td>
                                    <td class="text-center">
                                        <input type="radio" name="AttendanceChecks[@CheckIndex].IsPresent" value="false" checked/>
                                    </td>
                                    <td>
                                        <input type="text" name="AttendanceChecks[@CheckIndex].Note" class="span2" value="" />
                                    </td>
                                }
                                else
                                {
                                    if (Attendance.IsPresent)
                                    {
                                    <td class="text-center">
                                        <input type="radio" name="AttendanceChecks[@CheckIndex].IsPresent" value="true" checked/>
                                    </td>
                                    <td class="text-center">
                                        <input type="radio" name="AttendanceChecks[@CheckIndex].IsPresent" value="false"/>
                                    </td>
                                    }
                                    else
                                    {
                                    <td class="text-center">
                                        <input type="radio" name="AttendanceChecks[@CheckIndex].IsPresent" value="true"/>
                                    </td>
                                    <td class="text-center">
                                        <input type="radio" name="AttendanceChecks[@CheckIndex].IsPresent" value="false" checked/>
                                    </td>
                                    }
                                    <td>
                                        <input type="text" name="AttendanceChecks[@CheckIndex].Note" class="span2" value="@Attendance.Note" />
                                    </td>

                                }
                            </tr>
                                { AttendIndex++; CheckIndex++; }
                        }
                        <tr>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td class="text-center">
                                <input type="radio" name="totalRadio" id="PresentRadio" /><br />
                                Present All
                            </td>
                            <td class="text-center">
                                <input type="radio" name="totalRadio" id="AbsentRadio" /><br />
                                Absent All
                            </td>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn btn-info">
                    Submit Attendance</button>
            }
        </div>
    </fieldset>
</div>
<div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">
        Close</button>
</div>

<script>
    $('#PresentRadio').change(function () {
        $("input:radio[value=true]").prop("checked", true);
    });
    $('#AbsentRadio').change(function () {
        $("input:radio[value=false]").prop("checked", true);
    });
</script>
